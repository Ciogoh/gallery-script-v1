let img;let customFont = null; let renderBuffer;let inputImg, inputFont, inputChars, inputRes, inputContrast, inputThreshold, inputLeading, inputJitter, inputRotation;let selFont, pickerText, pickerBg, checkColor, checkVariableSize, checkInvert, selExportScale;let myText = "?"; const sidebarWidth = 260;function setup() {  let canvas = createCanvas(windowWidth - sidebarWidth, windowHeight);  canvas.position(sidebarWidth, 0);  pixelDensity(displayDensity());    let sidebar = createDiv('');  sidebar.id('mySidebar');  styleSidebar(sidebar);  createP('A RASTER TOOL')    .parent(sidebar)    .style('font-family', '"Inter", "Helvetica Neue", Helvetica, Arial, sans-serif')    .style('font-weight', '800') // Extra-bold per un look pi moderno    .style('font-size', '14px')    .style('letter-spacing', '2px')    .style('margin-bottom', '30px')    .style('color', '#ffffff')    .style('border-left', '3px solid #E91E63') // Piccola barra azzurra a sinistra    .style('padding-left', '10px');  // --- 1. SORGENTE ---  createLabel('1. IMMAGINE SORGENTE', sidebar);  inputImg = createFileInput(handleFile).parent(sidebar);    // --- 2. TIPOGRAFIA ---  createLabel('2. TIPOGRAFIA E TESTO', sidebar);    let labelTxt = createP('Testo da usare:').addClass('inner-label').parent(sidebar);  inputChars = createInput(myText).parent(sidebar);  inputChars.addClass('custom-input').input(() => { myText = inputChars.value(); loop(); });  let labelFont = createP('Carattere standard:').addClass('inner-label').parent(sidebar);  selFont = createSelect().parent(sidebar);  selFont.addClass('custom-select');  ['Monospace', 'Helvetica', 'Impact', 'Georgia'].forEach(f => selFont.option(f));  selFont.input(() => { customFont = null; loop(); });  let labelCust = createP('Carica font (.ttf/.otf):').addClass('inner-label').parent(sidebar);  inputFont = createFileInput(handleFont).parent(sidebar);  // PULSANTE RESET FONT (NUOVO)  let btnResetFont = createButton('Rimuovi Font Caricato').parent(sidebar);  btnResetFont.addClass('reset-font-btn').mousePressed(() => {    customFont = null;    inputFont.value(''); // Reset dell'input file    loop();  });  // --- 3. GRIGLIA ---  createLabel('3. DIMENSIONE E DENSITË', sidebar);  inputRes = createSlider(5, 100, 18, 1).parent(sidebar);   inputLeading = createSlider(0.5, 2.5, 1.0, 0.1).parent(sidebar);  // --- 4. TRASFORMAZIONE ---  createLabel('4. ROTAZIONE E DISORDINE', sidebar);  inputRotation = createSlider(0, TWO_PI, 0, 0.01).parent(sidebar);  inputJitter = createSlider(0, 50, 0, 1).parent(sidebar);  // --- 5. COLORI ---  createLabel('5. COLORI E MODALITË', sidebar);  let rowColor = createDiv('').parent(sidebar).style('display', 'flex').style('gap', '10px').style('margin-bottom', '15px');  pickerText = createColorPicker('#E91E63').parent(rowColor);  pickerBg = createColorPicker('#FFFFFF').parent(rowColor);    checkColor = createCheckbox(' Usa colori foto', false).parent(sidebar).addClass('custom-check');  checkVariableSize = createCheckbox(' Grandezza dinamica', true).parent(sidebar).addClass('custom-check');  checkInvert = createCheckbox(' Inverti zone disegno', false).parent(sidebar).addClass('custom-check');  // --- 6. FILTRI --- createLabel('7. CONTRASTO E SOGLIA LUCE', sidebar);  inputContrast = createSlider(1, 5, 1.5, 0.1).parent(sidebar);  inputThreshold = createSlider(0, 255, 127, 5).parent(sidebar);  // --- 7. EXPORT ---  createLabel('7. QUALITË DOWNLOAD', sidebar);  selExportScale = createSelect().parent(sidebar).addClass('custom-select');  selExportScale.option('Standard (Anteprima)', 1);  selExportScale.option('Alta Definizione (2x)', 2);  selExportScale.option('Qualitˆ Stampa (4x)', 4);  selExportScale.selected(2);   let uiElements = [selFont, inputRes, inputLeading, inputRotation, inputJitter, pickerText, pickerBg, checkColor, checkVariableSize, checkInvert, inputContrast, inputThreshold];  uiElements.forEach(el => el.input(loop));  let btnSave = createButton('SCARICA OPERA').parent(sidebar);  btnSave.addClass('save-button').mousePressed(exportHighRes);  noLoop();}function draw() {  background(30);   if (!img) {    fill(180); textAlign(CENTER, CENTER);    noStroke();    textSize(14);    text("CARICA UN'IMMAGINE DALLA SIDEBAR", width/2, height/2);    return;  }  if (!renderBuffer || renderBuffer.width !== img.width) {    renderBuffer = createGraphics(img.width, img.height);  }  renderArt(renderBuffer, 1);   addFooter(renderBuffer, 1);   let previewScale = min((width - 80) / img.width, (height - 80) / img.height);  push();  translate(width/2, height/2);  imageMode(CENTER);  fill(0, 80);  rect(-(img.width * previewScale)/2 + 8, -(img.height * previewScale)/2 + 8, img.width * previewScale, img.height * previewScale);  image(renderBuffer, 0, 0, img.width * previewScale, img.height * previewScale);  pop();    noLoop(); }function renderArt(pg, scaleFactor) {  pg.background(pickerBg.color());  pg.smooth();  let tempImg = img.get();  tempImg.loadPixels();    let res = inputRes.value() * scaleFactor;  let lead = inputLeading.value();  let jitter = inputJitter.value() * scaleFactor;  let rot = inputRotation.value();  let thresh = inputThreshold.value();  let contrast = inputContrast.value();  let charIndex = 0;    let safeW = pg.width * 0.35;  let safeH = pg.height - (pg.height * 0.08);  if (customFont) {    pg.textFont(customFont);  } else {    pg.textFont(selFont.value());  }    pg.textAlign(CENTER, CENTER);  for (let y = 0; y < tempImg.height; y += inputRes.value() * lead) {    for (let x = 0; x < tempImg.width; x += inputRes.value()) {      let scaledX = x * scaleFactor;      let scaledY = y * scaleFactor;      if (scaledX < safeW && scaledY > safeH) continue;      let i = (floor(x) + floor(y) * tempImg.width) * 4;      let r = tempImg.pixels[i];      let g = tempImg.pixels[i+1];      let b = tempImg.pixels[i+2];      r = constrain((r - 128) * contrast + 128, 0, 255);      g = constrain((g - 128) * contrast + 128, 0, 255);      b = constrain((b - 128) * contrast + 128, 0, 255);      let bright = (r + g + b) / 3;      let shouldDraw = checkInvert.checked() ? (bright > thresh) : (bright < thresh);      if (shouldDraw) {        pg.push();        pg.translate(scaledX + random(-jitter, jitter), scaledY + random(-jitter, jitter));        pg.rotate(rot);        let dSize = res;        if (checkVariableSize.checked()) {          dSize = checkInvert.checked() ? map(bright, thresh, 255, 0, res * 2) : map(bright, 0, thresh, res * 2, 0);        }        pg.textSize(max(dSize, 0.1));        pg.fill(checkColor.checked() ? color(r, g, b) : pickerText.color());        pg.text(myText.charAt(charIndex % myText.length), 0, 0);        pg.pop();        charIndex++;      }    }  }}function handleFont(file) {  if (file.name.toLowerCase().endsWith('.ttf') || file.name.toLowerCase().endsWith('.otf')) {    customFont = loadFont(file.data, () => {      loop();    });  }}function handleFile(file) { if (file.type === 'image') { img = loadImage(file.data, () => loop()); } }function addFooter(buffer, scaleFactor) {  buffer.push();  let m = buffer.width * 0.03;  let cFooter = color(pickerText.color());  buffer.stroke(cFooter);  buffer.strokeWeight(buffer.width * 0.001);  buffer.line(m, buffer.height - (buffer.height * 0.05), m + (buffer.width * 0.05), buffer.height - (buffer.height * 0.05));  buffer.noStroke();  cFooter.setAlpha(150);  buffer.fill(cFooter);  buffer.textFont('Helvetica');  buffer.textSize(buffer.height * 0.012);   buffer.textAlign(LEFT, BOTTOM);  buffer.text("Vibe Code Exercise", m, buffer.height - (buffer.height * 0.032));  cFooter.setAlpha(255);  buffer.fill(cFooter);  buffer.textStyle(BOLD);  buffer.textSize(buffer.height * 0.018);  buffer.text("Alice Federici", m, buffer.height - (buffer.height * 0.012));  buffer.pop();}function exportHighRes() {  if (!img) return;  let scale = int(selExportScale.value());  let hiResBuffer = createGraphics(img.width * scale, img.height * scale);  renderArt(hiResBuffer, scale);  addFooter(hiResBuffer, scale);  save(hiResBuffer, `opera_federici_${scale}x.png`);  hiResBuffer.remove();}function createLabel(t, p) {   createP(t).parent(p).addClass('sidebar-label');}function styleSidebar(s) {  s.style('width', sidebarWidth+'px').style('height', '100%').style('position', 'fixed').style('left', '0').style('top', '0');  s.style('background', '#0a0a0a').style('padding', '30px').style('border-right', '1px solid #222').style('overflow-y', 'auto').style('box-sizing', 'border-box').style('z-index', '100');    let style = createElement('style', `    body { background-color: #1e1e1e !important; margin: 0; overflow: hidden; }    .sidebar-label {       font-size: 10px !important;       font-weight: bold !important;       color: #ffffff !important;       margin: 30px 0 10px 0 !important;       text-transform: uppercase !important;       letter-spacing: 1.2px !important;      font-family: sans-serif;      border-bottom: 1px solid #222;      padding-bottom: 5px;    }    .inner-label {      color: #888 !important;      font-size: 9px !important;      margin: 10px 0 5px 0 !important;      font-family: sans-serif;      text-transform: uppercase;    }    .custom-input { background: #FFFFFF00; border: 1px solid #333; color: #E91E63; padding: 10px; border-radius: 4px; width: 100%; box-sizing: border-box; margin-bottom: 5px; font-family: monospace; }     .custom-select { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 8px; width: 100%; border-radius: 4px; margin-bottom: 5px; cursor: pointer; }     .custom-check { display: block !important; color: #ffffff !important; font-size: 11px !important; margin-bottom: 12px !important; cursor: pointer !important; font-family: sans-serif !important; }    .custom-check input { margin-right: 10px !important; transform: scale(1.2); }        .reset-font-btn {      background: #333;      color: #eee;      border: none;      padding: 5px 10px;      font-size: 9px;      border-radius: 3px;      cursor: pointer;      margin-bottom: 10px;      transition: 0.2s;    }    .reset-font-btn:hover { background: #444; color: #fff; }    .save-button { background: #E91E63; color: #FDFDFD; border: none; padding: 14px; font-weight: bold; width: 100%; margin-top: 30px; cursor: pointer; border-radius: 4px; transition: 0.3s; font-family: sans-serif; }     .save-button:hover { background: #fff; transform: scale(1.02); }     input[type=range] { width: 100%; accent-color: #E91E63; margin-top: 5px; }    input[type=file] { font-size: 9px; color: #555; margin-bottom: 5px; width: 100%; }  `);}function windowResized() { resizeCanvas(windowWidth - sidebarWidth, windowHeight); loop(); }