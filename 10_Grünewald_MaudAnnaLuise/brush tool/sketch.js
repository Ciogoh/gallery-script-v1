// --- GLOBAL VARIABLES ---let colorPicker, bgPicker, brushSlider, alphaSlider, shapeSelect, textureSelect, smoothingSlider;let btnClear, btnBrushMode, btnEraserMode, btnUndo, btnSave, btnSaveFav, btnSymmetry, btnGrid;let btnZoomIn, btnZoomOut, btnFullscreen, sizeLabel;let sidebar, favContainer;let sidebarWidth = 200;let artLayer; let zoomScale = 1.0;let offsetX = 0, offsetY = 0; let panSpeed = 10;// Minimap & Grid Settingslet minimapTimer = 0;let minimapDuration = 2000;let minimapAlpha = 0; let showGrid = false;let favorites = []; let isErasing = false;let isSymmetric = false;let history = []; let isDrawing = false; let uiLoaded = false;let smoothedX, smoothedY, prevSmoothedX, prevSmoothedY;// --- UTILITY: SECTION CREATOR ---function createSection(t, s) {   return createElement('div', t).parent(sidebar).style(s); }function setup() {  createCanvas(windowWidth, windowHeight);    // Create the high-res drawing buffer  artLayer = createGraphics(windowWidth - sidebarWidth, windowHeight);  artLayer.clear();  saveState();  smoothedX = mouseX; smoothedY = mouseY;  prevSmoothedX = mouseX; prevSmoothedY = mouseY;  // --- SIDEBAR SETUP ---  sidebar = createDiv().position(0,0).size(sidebarWidth, windowHeight).style('background-color', '#f0f0f0').style('border-right', '1px solid #ccc').style('padding', '10px').style('box-sizing', 'border-box').style('display', 'flex').style('flex-direction', 'column').style('gap', '5px').style('z-index', '100').style('overflow-y', 'auto');  let labelStyle = 'font-family: Helvetica; font-weight: bold; font-size: 10px; color: #555; text-transform: uppercase; margin-top: 5px;';  let ctrlStyle = 'width: 178px; font-family: Helvetica; font-size: 11px;';  // 1. Color Palette  createSection('Quick Colors', labelStyle);  let swatchContainer = createDiv().parent(sidebar).style('display', 'grid').style('grid-template-columns', 'repeat(5, 1fr)').style('gap', '3px');  let standardColors = ['#000000', '#FFFFFF', '#7F7F7F', '#880015', '#ED1C24', '#FF7F27', '#FFF200', '#22B14C', '#00A2E8', '#3F48CC'];  standardColors.forEach(c => {    let s = createButton('').parent(swatchContainer).size(32, 20).style('background-color', c).style('border', '1px solid #ccc').style('cursor', 'pointer');    s.mousePressed(() => colorPicker.value(c));  });  // 2. Ink & Paper  createSection('Ink & Paper', labelStyle);  colorPicker = createColorPicker('#000000').parent(sidebar).style('width', '178px');  bgPicker = createColorPicker('#ffffff').parent(sidebar).style('width', '178px');  createElement('div', 'Brush Opacity').parent(sidebar).style(labelStyle);  alphaSlider = createSlider(0, 255, 255).parent(sidebar).style('width', '178px');  // 3. View & Grid  createSection('View & Grid', labelStyle);  let zoomGroup = createDiv().parent(sidebar).style('display', 'flex').style('gap', '3px');  btnZoomIn = createButton('+').parent(zoomGroup).style('flex', '1');  btnZoomIn.mousePressed(() => { zoomScale = constrain(zoomScale + 0.1, 0.1, 5.0); minimapTimer = millis(); });  btnZoomOut = createButton('-').parent(zoomGroup).style('flex', '1');  btnZoomOut.mousePressed(() => { zoomScale = constrain(zoomScale - 0.1, 0.1, 5.0); minimapTimer = millis(); });  btnGrid = createButton('Toggle Grid').parent(sidebar).style(ctrlStyle);  btnGrid.mousePressed(() => showGrid = !showGrid);  btnFullscreen = createButton('Fullscreen').parent(sidebar).style(ctrlStyle);  btnFullscreen.mousePressed(() => fullscreen(!fullscreen()));  // 4. Brush Settings  createSection('Brush Settings', labelStyle);  sizeLabel = createElement('div', 'Size: 10px').parent(sidebar).style('font-size', '10px').style('color', '#777');  brushSlider = createSlider(1, 200, 10).parent(sidebar).style('width', '178px');  shapeSelect = createSelect().parent(sidebar).style(ctrlStyle);  shapeSelect.option('Calligraphy'); shapeSelect.option('Round'); shapeSelect.option('Square');  textureSelect = createSelect().parent(sidebar).style(ctrlStyle);  textureSelect.option('Flat'); textureSelect.option('Charcoal'); textureSelect.option('Watercolor'); textureSelect.option('Splatter'); textureSelect.option('Stipple'); textureSelect.option('Hatching');  // 5. Stabilizer & Symmetry  createSection('Stabilizer', labelStyle);  smoothingSlider = createSlider(0, 95, 50).parent(sidebar).style('width', '178px');  btnSymmetry = createButton('Mirror: OFF').parent(sidebar).style(ctrlStyle);  btnSymmetry.mousePressed(() => isSymmetric = !isSymmetric);  // 6. Palette  createSection('Saved Favorites', labelStyle);  btnSaveFav = createButton('Save Current Brush').parent(sidebar).style(ctrlStyle);  btnSaveFav.mousePressed(addFavorite);  favContainer = createDiv().parent(sidebar).style('display', 'flex').style('flex-direction', 'column').style('gap', '3px');  // 7. Actions  createSection('Actions', labelStyle);  let modeGroup = createDiv().parent(sidebar).style('display', 'flex').style('gap', '3px');  btnBrushMode = createButton('Brush').parent(modeGroup).style('flex', '1');  btnBrushMode.mousePressed(() => isErasing = false);  btnEraserMode = createButton('Eraser').parent(modeGroup).style('flex', '1');  btnEraserMode.mousePressed(() => isErasing = true);  btnUndo = createButton('Undo (Ctrl+Z)').parent(sidebar).style(ctrlStyle);  btnUndo.mousePressed(undoLast);  btnClear = createButton('Reset Canvas').parent(sidebar).style(ctrlStyle);  btnClear.mousePressed(() => { artLayer.clear(); saveState(); offsetX=0; offsetY=0; zoomScale=1.0; });  btnSave = createButton('Export PNG').parent(sidebar).style(ctrlStyle);  btnSave.mousePressed(saveImage);  uiLoaded = true;}function draw() {  background(220);   if (!uiLoaded) return;  sizeLabel.html('Size: ' + brushSlider.value() + 'px');  // Keyboard Panning  if (keyIsDown(LEFT_ARROW))  { offsetX += panSpeed; minimapTimer = millis(); }  if (keyIsDown(RIGHT_ARROW)) { offsetX -= panSpeed; minimapTimer = millis(); }  if (keyIsDown(UP_ARROW))    { offsetY += panSpeed; minimapTimer = millis(); }  if (keyIsDown(DOWN_ARROW))  { offsetY -= panSpeed; minimapTimer = millis(); }  // 1. Draw Workspace View  push();  translate(sidebarWidth + offsetX, offsetY);  scale(zoomScale);  noStroke(); fill(0, 40); rect(8/zoomScale, 8/zoomScale, artLayer.width, artLayer.height); // Shadow  fill(bgPicker.color()); rect(0, 0, artLayer.width, artLayer.height); // Paper  if (showGrid) drawDraftingGrid();  image(artLayer, 0, 0);  if (isSymmetric) {    stroke(200, 150); strokeWeight(1/zoomScale);    line(artLayer.width/2, 0, artLayer.width/2, artLayer.height);  }  pop();  // 2. Sidebar Backdrop  noStroke(); fill(240); rect(0, 0, sidebarWidth, height);     updateButtonStyles();  handleDrawing();  // Minimap with Auto-Hide Fade  let timeSinceMove = millis() - minimapTimer;  if (timeSinceMove < minimapDuration) minimapAlpha = lerp(minimapAlpha, 255, 0.15);  else minimapAlpha = lerp(minimapAlpha, 0, 0.08);  if (minimapAlpha > 1) drawMinimap(minimapAlpha);}function keyPressed() {  if ((keyIsDown(CONTROL) || keyIsDown(91)) && keyCode === 90) undoLast();}function drawDraftingGrid() {  stroke(200, 100); strokeWeight(0.5 / zoomScale);  for (let x = 0; x <= artLayer.width; x += 50) line(x, 0, x, artLayer.height);  for (let y = 0; y <= artLayer.height; y += 50) line(0, y, artLayer.width, y);}function handleDrawing() {  let artX = (mouseX - (sidebarWidth + offsetX)) / zoomScale;  let artY = (mouseY - offsetY) / zoomScale;  let sf = map(smoothingSlider.value(), 0, 100, 1, 0.02);  smoothedX = lerp(smoothedX, artX, sf); smoothedY = lerp(smoothedY, artY, sf);  if (mouseIsPressed && mouseX > sidebarWidth) {    if (!isDrawing) { isDrawing = true; smoothedX = artX; smoothedY = artY; prevSmoothedX = artX; prevSmoothedY = artY; }    artLayer.push();    if (isErasing) artLayer.erase();    else { let c = color(colorPicker.color()); c.setAlpha(alphaSlider.value()); artLayer.stroke(c); artLayer.fill(c); }    executeDraw(smoothedX, smoothedY, prevSmoothedX, prevSmoothedY, brushSlider.value());    artLayer.noErase(); artLayer.pop();    prevSmoothedX = smoothedX; prevSmoothedY = smoothedY;  } else if (isDrawing) { saveState(); isDrawing = false; }}function executeDraw(x, y, px, py, sz) {  let s = shapeSelect.value(); let t = textureSelect.value();  drawBrush(s, t, x, y, px, py, sz);  if (isSymmetric) {    let cx = artLayer.width/2;    drawBrush(s, t, cx - (x - cx), y, cx - (px - cx), py, sz);  }}function drawBrush(shape, texture, mx, my, pmx, pmy, size) {  if (texture !== 'Flat' && !isErasing) {    artLayer.noStroke(); let steps = max(1, dist(mx, my, pmx, pmy) / 2);    for (let i = 0; i <= steps; i++) renderTexture(texture, lerp(pmx, mx, i/steps), lerp(pmy, my, i/steps), size);  } else {    if (shape === 'Calligraphy') { artLayer.strokeWeight(size * 0.2); artLayer.line(pmx, pmy, mx, my); }    else if (shape === 'Round') { artLayer.strokeWeight(size); artLayer.line(pmx, pmy, mx, my); artLayer.noStroke(); artLayer.ellipse(mx, my, size, size); }    else if (shape === 'Square') { artLayer.noStroke(); artLayer.rectMode(CENTER); let d = dist(mx, my, pmx, pmy); for(let i=0; i<=1; i+=1/max(1,d/(size/4))) artLayer.rect(lerp(pmx,mx,i), lerp(pmy,my,i), size, size); }  }}function renderTexture(t, x, y, s) {  if (t === 'Charcoal') artLayer.ellipse(x + random(-s/4, s/4), y + random(-s/4, s/4), random(1, 3));  else if (t === 'Watercolor') artLayer.ellipse(x + random(-s/2, s/2), y + random(-s/2, s/2), s * random(0.5, 1));  else if (t === 'Splatter') { if (random(1) < 0.1) artLayer.ellipse(x + random(-s, s), y + random(-s, s), random(s*0.1, s*0.3)); }  else if (t === 'Stipple') artLayer.ellipse(x + random(-s/2, s/2), y + random(-s/2, s/2), 1);  else if (t === 'Hatching') { artLayer.strokeWeight(1); artLayer.line(x, y, x + random(-5, 5), y + random(-5, 5)); artLayer.noStroke(); }}function addFavorite() {  let s = shapeSelect.value(); let t = textureSelect.value();  let name = (t === 'Flat' ? s : s + " " + t);  favorites.push({ name, color: colorPicker.value(), size: brushSlider.value(), alpha: alphaSlider.value(), shape: s, texture: t });  renderFavorites();}function renderFavorites() {  favContainer.html('');  favorites.forEach((f, i) => {    let row = createDiv().parent(favContainer).style('display', 'flex').style('gap', '2px');    let btn = createButton(f.name).parent(row).style('flex', '1').style('height', '20px').style('font-size', '9px').style('background-color', f.color).style('color', brightness(color(f.color)) > 50 ? '#000' : '#fff');    btn.mousePressed(() => { colorPicker.value(f.color); brushSlider.value(f.size); alphaSlider.value(f.alpha); shapeSelect.selected(f.shape); textureSelect.selected(f.texture); });    let del = createButton('X').parent(row).size(20, 20).style('font-size', '9px');    del.mousePressed(() => { favorites.splice(i, 1); renderFavorites(); });  });}function drawMinimap(a) {  let mW = 150; let mH = (artLayer.height / artLayer.width) * mW;  let mX = width - mW - 15; let mY = 15;  push();  stroke(150, a); fill(bgPicker.color().levels[0], bgPicker.color().levels[1], bgPicker.color().levels[2], a);  rect(mX, mY, mW, mH);  tint(255, a); image(artLayer, mX, mY, mW, mH);  let mS = mW / artLayer.width;  let vW = (width - sidebarWidth) / zoomScale * mS; let vH = height / zoomScale * mS;  let vX = mX - (offsetX / zoomScale) * mS; let vY = mY - (offsetY / zoomScale) * mS;  noFill(); stroke(255, 0, 0, a); rect(vX, vY, vW, vH);  pop();}function updateButtonStyles() {  let b = 'font-family: Helvetica; cursor: pointer; border-radius: 3px; font-size: 10px; border: 1px solid #ccc; background-color: #fff; color: #444; text-transform: uppercase;';  let a = 'font-family: Helvetica; cursor: pointer; border-radius: 3px; font-size: 10px; background-color: #000; color: #fff; border: none; text-transform: uppercase;';  if (uiLoaded) {    btnBrushMode.style(isErasing ? b : a); btnEraserMode.style(isErasing ? a : b);    btnSymmetry.style(isSymmetric ? a : b); btnSymmetry.html(isSymmetric ? 'Mirror: ON' : 'Mirror: OFF');    btnGrid.style(showGrid ? a : b);    [btnUndo, btnClear, btnSaveFav, btnZoomIn, btnZoomOut, btnSave, btnFullscreen].forEach(btn => btn.style(b));  }}function mouseWheel(e) { if (mouseX > sidebarWidth) { zoomScale = constrain(zoomScale - e.delta * 0.001, 0.1, 5.0); minimapTimer = millis(); return false; } }function saveState() { let snap = createGraphics(artLayer.width, artLayer.height); snap.image(artLayer, 0, 0); history.push(snap); if (history.length > 20) history.shift(); }function undoLast() { if (history.length > 1) { history.pop(); artLayer.clear(); artLayer.image(history[history.length - 1], 0, 0); }}function saveImage() { let out = createGraphics(artLayer.width, artLayer.height); out.background(bgPicker.color()); out.image(artLayer, 0, 0); out.save('drawing.png'); }function windowResized() { resizeCanvas(windowWidth, windowHeight); sidebar.size(sidebarWidth, windowHeight); }